<body class="antialiased" data-current="resources">
    <div id="header-placeholder"></div>

    <main class="max-w-4xl mx-auto px-6 py-24">
        
        <header class="text-center mb-20 editorial-header pb-16">
            <h3 id="dive-part" class="text-gold text-[0.7rem] font-bold tracking-[0.5em] uppercase mb-8">Loading...</h3>
            <h1 id="dive-title" class="text-6xl md:text-8xl font-bold mb-10 leading-[1.05] tracking-tight text-charcoal">
                </h1>
            
            <p id="dive-lead-quote" class="text-2xl md:text-3xl text-charcoal font-light leading-relaxed italic lead-quote pl-8 text-left mx-auto max-w-3xl py-4">
                </p>
        </header>

        <section class="max-w-2xl mx-auto text-center mb-24">
            <h4 class="text-gold text-[0.65rem] font-bold tracking-[0.4em] uppercase mb-4">The Foundation</h4>
            <h2 id="dive-scripture" class="text-3xl font-bold mb-6 italic"></h2>
            <div id="bible-link-container"></div>
        </section>

        <section class="mb-32">
            <div id="video-placeholder" class="relative rounded-[3rem] overflow-hidden shadow-2xl bg-zinc-200 aspect-video">
                </div>
        </section>

        <article id="dive-body" class="space-y-24 mb-32 prose prose-xl prose-stone max-w-none">
            </article>

        <section class="mt-32 text-center max-w-2xl mx-auto border-t border-zinc-100 pt-20">
            <h3 class="text-gold text-[0.7rem] font-bold tracking-[0.4em] uppercase mb-10">The Send</h3>
            <div class="space-y-6 text-2xl text-charcoal font-light italic leading-relaxed mb-12">
                <p>"The Lord opened her heart... and she opened her home."</p>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

 <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    async function loadContent() {
        const urlParams = new URLSearchParams(window.location.search);
        const diveId = urlParams.get('id');
        
        console.log("Searching for message ID:", diveId); // Debugging line

        if (!diveId) {
            document.getElementById('dive-title').innerText = "No ID Provided";
            return;
        }

        try {
            // Updated Path: Ensure this matches your GitHub structure exactly
            const filePath = `/res/deep/2026/${diveId}.md`;
            const response = await fetch(filePath);
            
            if (!response.ok) {
                console.error("File not found at:", filePath);
                document.getElementById('dive-title').innerText = "Message Not Found";
                return;
            }
            
            const rawText = await response.text();

            // 1. Split by the triple dashes
            const parts = rawText.split('---');
            if (parts.length < 3) {
                console.error("Markdown format error: Missing frontmatter dashes.");
                return;
            }

            // 2. Parse Metadata (The Frontmatter)
            const metadata = {};
            parts[1].trim().split('\n').forEach(line => {
                const [key, ...val] = line.split(':');
                if (key) metadata[key.trim().toLowerCase()] = val.join(':').trim().replace(/^"(.*)"$/, '$1');
            });

            console.log("Metadata Loaded:", metadata); // Debugging line

            // 3. Inject into the Page with Fallbacks
            document.title = `${metadata.title || 'Study'} | The Living Room`;
            document.getElementById('dive-title').innerText = metadata.title || "Untitled";
            document.getElementById('dive-part').innerText = metadata.part || "Sunday Deep Dive";
            document.getElementById('dive-lead-quote').innerText = metadata.lead_quote || "";
            document.getElementById('dive-scripture').innerText = metadata.scripture || "";
            
            // 4. Handle YouTube
            if (metadata.youtube_id) {
                document.getElementById('video-placeholder').innerHTML = `
                    <iframe class="absolute inset-0 w-full h-full" 
                            src="https://www.youtube.com/embed/${metadata.youtube_id}" 
                            frameborder="0" allowfullscreen></iframe>`;
            }

            // 5. Render the Body (Everything after the second ---)
            const bodyMarkdown = parts.slice(2).join('---').trim();
            document.getElementById('dive-body').innerHTML = marked.parse(bodyMarkdown);

        } catch (err) {
            console.error("Critical Error:", err);
            document.getElementById('dive-title').innerText = "Error Loading Content";
        }
    }

    async function loadShared() {
        const [h, f] = await Promise.all([fetch('/components/header.html'), fetch('/components/footer.html')]);
        if(h.ok) document.getElementById('header-placeholder').innerHTML = await h.text();
        if(f.ok) document.getElementById('footer-placeholder').innerHTML = await f.text();
    }

    window.onload = () => { loadShared(); loadContent(); };
</script>
</body>