<body class="antialiased" data-current="resources">
    <div id="header-placeholder"></div>

    <main class="max-w-4xl mx-auto px-6 py-24">
        
        <header class="text-center mb-20 editorial-header pb-16">
            <h3 id="dive-part" class="text-gold text-[0.7rem] font-bold tracking-[0.5em] uppercase mb-8">Loading...</h3>
            <h1 id="dive-title" class="text-6xl md:text-8xl font-bold mb-10 leading-[1.05] tracking-tight text-charcoal">
                </h1>
            
            <p id="dive-lead-quote" class="text-2xl md:text-3xl text-charcoal font-light leading-relaxed italic lead-quote pl-8 text-left mx-auto max-w-3xl py-4">
                </p>
        </header>

        <section class="max-w-2xl mx-auto text-center mb-24">
            <h4 class="text-gold text-[0.65rem] font-bold tracking-[0.4em] uppercase mb-4">The Foundation</h4>
            <h2 id="dive-scripture" class="text-3xl font-bold mb-6 italic"></h2>
            <div id="bible-link-container"></div>
        </section>

        <section class="mb-32">
            <div id="video-placeholder" class="relative rounded-[3rem] overflow-hidden shadow-2xl bg-zinc-200 aspect-video">
                </div>
        </section>

        <article id="dive-body" class="space-y-24 mb-32 prose prose-xl prose-stone max-w-none">
            </article>

        <section class="mt-32 text-center max-w-2xl mx-auto border-t border-zinc-100 pt-20">
            <h3 class="text-gold text-[0.7rem] font-bold tracking-[0.4em] uppercase mb-10">The Send</h3>
            <div class="space-y-6 text-2xl text-charcoal font-light italic leading-relaxed mb-12">
                <p>"The Lord opened her heart... and she opened her home."</p>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script>
        async function loadContent() {
            // 1. Get the ID from the URL (e.g., deepdive.html?id=the-open-road)
            const urlParams = new URLSearchParams(window.location.search);
            const diveId = urlParams.get('id');
            
            if (!diveId) {
                window.location.href = '/deepdives.html';
                return;
            }

            try {
                // 2. Fetch the Markdown file from your res/deep/2026 folder
                const response = await fetch(`/res/deep/2026/${diveId}.md`);
                if (!response.ok) throw new Error('File not found');
                
                const rawText = await response.text();

                // 3. Simple Frontmatter Extractor
                // Decap saves info like Title and YouTube ID at the top between ---
                const parts = rawText.split('---');
                const frontmatter = {};
                if (parts.length > 2) {
                    const lines = parts[1].trim().split('\n');
                    lines.forEach(line => {
                        const [key, ...val] = line.split(':');
                        if (key) frontmatter[key.trim()] = val.join(':').trim();
                    });
                }

                const bodyMarkdown = parts.slice(2).join('---').trim();

                // 4. Inject into Page
                document.title = `${frontmatter.title} | Deep Dive`;
                document.getElementById('dive-title').innerText = frontmatter.title;
                document.getElementById('dive-part').innerText = frontmatter.part || "Sunday Deep Dive";
                document.getElementById('dive-lead-quote').innerText = frontmatter.lead_quote || "";
                document.getElementById('dive-scripture').innerText = frontmatter.scripture || "";
                
                if (frontmatter.youtube_id) {
                    document.getElementById('video-placeholder').innerHTML = `
                        <iframe class="absolute inset-0 w-full h-full" src="https://www.youtube.com/embed/${frontmatter.youtube_id}" frameborder="0" allowfullscreen></iframe>`;
                }

                // 5. Render the Body Content
                document.getElementById('dive-body').innerHTML = marked.parse(bodyMarkdown);

            } catch (err) {
                console.error("Error:", err);
                document.getElementById('dive-title').innerText = "Message Not Found";
            }
        }

        // Standard Component Loader
        async function loadShared() {
            const [h, f] = await Promise.all([fetch('/components/header.html'), fetch('/components/footer.html')]);
            if(h.ok) document.getElementById('header-placeholder').innerHTML = await h.text();
            if(f.ok) document.getElementById('footer-placeholder').innerHTML = await f.text();
        }

        window.onload = () => { loadShared(); loadContent(); };
    </script>
</body>